[build]
builder = "nixpacks"
buildCommand = "composer install --no-interaction --optimize-autoloader && npm install && npm run build && php artisan key:generate && php artisan optimize"

[deploy]
startCommand = "php artisan migrate --force && php artisan serve --host=0.0.0.0 --port=$PORT"
healthchecks = { cmd = "curl -f http://localhost:$PORT/ || exit 1", interval = 10, timeout = 5, start_period = 60 }

[[services]]
name = "fuel-tracking-system"
type = "web"

[services.build]
builder = "nixpacks"
buildCommand = "composer install --no-interaction --optimize-autoloader && npm install && npm run build && php artisan key:generate && php artisan optimize"

[services.deploy]
startCommand = "php artisan migrate --force && php artisan serve --host=0.0.0.0 --port=$PORT"
healthchecks = { cmd = "curl -f http://localhost:$PORT/ || exit 1", interval = 10, timeout = 5, start_period = 60 }

[[services.volumes]]
source = "storage"
path = "/app/storage"
ephemeral = false

[[services]]
name = "mysql"
type = "database"

[services.data]
name = "MySQL"
